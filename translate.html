<!DOCTYPE html>
<html lang="en">

<head>
    <title>News</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
    <link rel="stylesheet" href="https://www.w3schools.com/lib/w3-theme-light-blue.css" id="css">
    <link rel="stylesheet" href="styles/styles.css">
</head>
<body>

<div class="w3-container w3-theme-l1">
    <div id="menu" class="w3-bar"></div>
</div>

<div class="w3-container w3-theme w3-padding-16">
    <label for="phrase">Phrase</label>
    <input type="text" id="phrase">
    <button id="translate">Translate</button>

    <ul id="speech"></ul>
    <ul id="translation"></ul>
</div>
</body>
<script>
	let speech      = document.getElementById("speech");
    let translation = document.getElementById("translation");
    let translate   = document.getElementById("translate");
    let phrase      = document.getElementById("phrase");
    translate.addEventListener('click', translatePhrase);

    function translatePhrase() {
        let text = phrase.value;
        howDoYouSay(text, "en", "nl");
    }
	// speech to text
	const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;

	const recognition = new SpeechRecognition();
	recognition.start();

	// recognition.continuous = true;
	// recognition.interimResults = true;
	recognition.onresult = event => {
		recognition.stop();
		const last = event.results.length - 1;
		const res = event.results[last];
		const text = res[0].transcript;
		speech.innerHTML += `<li>${text}</li>`;
		if (res.isFinal) {
			speech.innerHTML += `<li>You said: ${text}</li>`;
			var uniqueArray = [...new Set(text.toLowerCase().split(' '))]
			if (uniqueArray.indexOf('color') >= 0) {
				uniqueArray.splice(uniqueArray.indexOf('color'),1);
				let color = uniqueArray.join('');
				document.body.style.backgroundColor = color;
            }
			// text to speech
            howDoYouSay(text, "en", "nl");
		}
	}


	function howDoYouSay(text, from, to) {
		const params = new URLSearchParams();
		params.append("to",     to);
		params.append("from",   from);
		params.append("texts",  text);

		const options = {
			method: "POST",
			headers: {
				"content-type": "application/x-www-form-urlencoded",
				"x-rapidapi-host": "lecto-translation.p.rapidapi.com",
				"x-rapidapi-key": "498ed225bamshcd02cf5559e10edp179d21jsn59b140b93ec5",
			},
			body: params,
		};

		fetch("https://lecto-translation.p.rapidapi.com/v1/translate/text?to=nl&from=en", options)
			.then(response => response.json())
			.then(json => {
				let text = json.translations[0].translated[0];
				translation.innerHTML += `<li>${text}</li>`;
				recognition.start();
			})
			.catch( error => console.error(error));
	}
</script>
<script src="js/menu.js"></script>
<script>makeMeActive('Translate')</script>
</html>