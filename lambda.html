<!DOCTYPE html>
<html lang="en">
<head>
    <title>Lambda</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="styles/w3.css">
    <link rel="stylesheet" href="https://www.w3schools.com/lib/w3-theme-indigo.css">
    <link href="styles/styles.css" media="screen"  rel="stylesheet"/>
</head>
<body>

<div class="w3-container w3-theme-l1">
    <div id="menu" class="w3-bar"></div>
</div>

<div class="w3-container w3-theme w3-padding-16">
    <!--<form action="http://kxsd87wapg.execute-api.us-east-2.amazonaws.com/dev" method="POST">-->
    <label for="quote">New Quote</label>
    <input type="text" id="quote">
    <button id="save">Save Quote</button>

    <label for="names">New Student</label>
    <input type="text" id="names">
    <button id="saveStudent">Save Student</button>
    <!--</form>-->
</div>
<div class="w3-container w3-theme-l3 w3-padding-16">
    <table class='w3-table-all sortable w3-theme'>
        <thead>
        <tr class="w3-theme-l4 w3-bordered">
            <th>ID</th> <th>Text</th> <th>Delete</th>
        </tr>
        </thead>
        <tbody id="rows"></tbody>
    </table>
</div>
</body>
<script>
	let rows = document.getElementById("rows");

	window.addEventListener("load", () => getQuoteList());
	// window.addEventListener("load", () => getStudentList());

	let quote = document.getElementById("quote");
	document.getElementById("save").addEventListener("click", () => createQuote());

	function createQuote() {
		rows.innerHTML = '';            //  empty out the list
		fetch('https://kxsd87wapg.execute-api.us-east-2.amazonaws.com/dev', {
			method: 'POST',
			mode: "no-cors", // or without this line
			headers: {
				'Content-Type': 'application/json',
				'Accept': '*/*',
			},
			body: JSON.stringify({name: quote.value })
		})
			.then(data => getQuoteList())
			.catch(err => console.log('Fetch Error :', err) );
	}

	let row = 0;
	function getQuoteList() {
		//fetch API for global info
		fetch("https://kxsd87wapg.execute-api.us-east-2.amazonaws.com/dev")
			.then(response => response.json())
			.then(quotes => {
                quotes.forEach(q => {
					row++;
                    let tr = `
                    <tr class="w3-theme-${row % 2 > 0 ?"l2":"l3"}">
                        <td>${(new Date(+q.id)).toString().substring(4,24)}</td>
                        <td>${q.Name}</td>
                        <td id="${q.id}">X</td>
                    </tr>`;
					rows.innerHTML += tr;
				});
				row++;
				rows.innerHTML += `<tr class="w3-theme-${row % 2 > 0 ?"l2":"l3"}"> <td>ta da!</td><td>${new Date().toTimeString()}</td><td></td></tr>`;
				quotes.forEach(q => {
					let ref = document.getElementById(q.id);
					ref.addEventListener('click', () => deleteQuote(q.id));
					// document.getElementById(q.id).addEventListener('click', deleteQuote);
				});
			})
			.catch(function(err) {
				console.log('Fetch Error :', err);
        });
	}

	function deleteQuote(id) {
		console.log(id);
		fetch('https://kxsd87wapg.execute-api.us-east-2.amazonaws.com/dev', {
			method: 'DELETE',
			headers: {
				'Content-Type': 'application/json',
				'Accept': '*/*',
			},
			body: JSON.stringify({id: id })
		})
			.then(response => response.json())
			.then(data => getQuoteList())
			.catch(err => console.log('Fetch Error :', err) );
    }

//--------------------------------------

	let names = document.getElementById("names");
	document.getElementById("saveStudent").addEventListener("click", () => createStudent());

	function createStudent(){
		let studentNames = names.value.split(' ');
		rows.innerHTML = '';            //  empty out the list
		fetch('https://759y9aw8fh.execute-api.us-east-2.amazonaws.com/dev', {
			method: 'POST',
			mode: "no-cors", // or without this line
			headers: {
				'Content-Type': 'application/json',
				'Accept': '*/*',
			},
			body: JSON.stringify({name: studentNames[0], lastName: studentNames[1] })
		})
			.then(response => response.json())
			.then(data => getStudentList())
			.catch(err => console.log('Fetch Error :', err));
	}

	function getStudentList() {
		//fetch API for global info
		fetch("https://759y9aw8fh.execute-api.us-east-2.amazonaws.com/dev")
			.then((response) => response.json())
			.then((quotes) => {
				let rows = document.getElementById("rows");
				//assigning values
				quotes.forEach(q => {
					let tr = `<tr> <td>${q.name}</td> <td>${q.lastName}</td></tr>`;
					rows.innerHTML += tr;
				});
				rows.innerHTML += 'ta da! ' + new Date().toTimeString();
			})
			.catch(function(err) {
				console.log('Fetch Error :', err);
			});
	}
</script>
</html>